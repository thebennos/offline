<!DOCTYPE html>

<html>
<head>
  <title>snake.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="offline.html">
                offline.coffee
              </a>
            
              
              <a class="source" href="reconnect.html">
                reconnect.coffee
              </a>
            
              
              <a class="source" href="requests.html">
                requests.coffee
              </a>
            
              
              <a class="source" href="snake.html">
                snake.coffee
              </a>
            
              
              <a class="source" href="ui.html">
                ui.coffee
              </a>
            
              
              <a class="source" href="_keyframes.html">
                _keyframes.sass
              </a>
            
              
              <a class="source" href="_mixins.html">
                _mixins.sass
              </a>
            
              
              <a class="source" href="_offline-theme-base-indicator.html">
                _offline-theme-base-indicator.sass
              </a>
            
              
              <a class="source" href="_offline-theme-base.html">
                _offline-theme-base.sass
              </a>
            
              
              <a class="source" href="offline-theme-chrome-indicator.html">
                offline-theme-chrome-indicator.sass
              </a>
            
              
              <a class="source" href="offline-theme-chrome.html">
                offline-theme-chrome.sass
              </a>
            
              
              <a class="source" href="offline-theme-dark-indicator.html">
                offline-theme-dark-indicator.sass
              </a>
            
              
              <a class="source" href="offline-theme-dark.html">
                offline-theme-dark.sass
              </a>
            
              
              <a class="source" href="offline-theme-default-indicator.html">
                offline-theme-default-indicator.sass
              </a>
            
              
              <a class="source" href="offline-theme-default.html">
                offline-theme-default.sass
              </a>
            
              
              <a class="source" href="offline-theme-hubspot.html">
                offline-theme-hubspot.sass
              </a>
            
              
              <a class="source" href="offline-theme-slide-indicator.html">
                offline-theme-slide-indicator.sass
              </a>
            
              
              <a class="source" href="offline-theme-slide.html">
                offline-theme-slide.sass
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>snake.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>canvas = dot = score = speed = stop = snake = randDot = fill = <span class="literal">null</span>

<span class="function"><span class="title">render</span></span> = -&gt;
  canvas = document.createElementNS(<span class="string">'http://www.w3.org/2000/svg'</span>, <span class="string">'svg'</span>)
  canvas.setAttribute <span class="string">'style'</span>, <span class="string">'width: 100%; height: 100%; margin: -8px; position: absolute; top: 0; left: 0; z-index: 1000'</span>
  canvas.setAttribute <span class="string">'viewBox'</span>, <span class="string">'0 0 1000 1000'</span>
  document.body.appendChild canvas

  dot = document.createElementNS(<span class="string">'http://www.w3.org/2000/svg'</span>, <span class="string">'circle'</span>)
  dot.setAttribute <span class="string">'r'</span>, <span class="number">20</span>
  <span class="keyword">do</span> <span class="function"><span class="title">randDot</span></span> = -&gt;
    dot.setAttribute <span class="string">'cx'</span>, (Math.random() * <span class="number">960</span>)|<span class="number">0</span> + <span class="number">20</span>
    dot.setAttribute <span class="string">'cy'</span>, (Math.random() * <span class="number">960</span>)|<span class="number">0</span> + <span class="number">20</span>

  canvas.appendChild dot

  snake =
    direction: <span class="number">0</span>
    nodes: []

  score = <span class="number">0</span>
  speed = <span class="number">10</span>
  stop = <span class="literal">false</span>

  move()

<span class="function"><span class="title">move</span></span> = -&gt;
  <span class="keyword">return</span> <span class="keyword">if</span> stop

  lastNode = snake.nodes[snake.nodes.length - <span class="number">1</span>]
  <span class="keyword">if</span> lastNode
    lastX = +lastNode.getAttribute(<span class="string">'cx'</span>)
    lastY = +lastNode.getAttribute(<span class="string">'cy'</span>)

  <span class="keyword">else</span>
    lastX = <span class="number">500</span>
    lastY = <span class="number">500</span>

  <span class="keyword">if</span> snake.nodes.length &gt; score
    old = snake.nodes.shift()
    canvas.removeChild old

  nX = lastX + Math.cos(snake.direction) * speed
  nY = lastY + Math.sin(snake.direction) * speed

  node = document.createElementNS(<span class="string">'http://www.w3.org/2000/svg'</span>, <span class="string">'circle'</span>)
  node.setAttribute <span class="string">'r'</span>, <span class="number">20</span>
  node.setAttribute <span class="string">'cx'</span>, nX
  node.setAttribute <span class="string">'cy'</span>, nY

  <span class="keyword">if</span> fill
    node.style.fill = fill

  dotX = +dot.getAttribute(<span class="string">'cx'</span>)
  dotY = +dot.getAttribute(<span class="string">'cy'</span>)
  <span class="keyword">if</span> dotX - <span class="number">20</span> &lt; nX &lt; dotX + <span class="number">20</span> <span class="keyword">and</span> dotY - <span class="number">20</span> &lt; nY &lt; dotY + <span class="number">20</span>
    score++
    speed++
    randDot()

  canvas.appendChild node
  snake.nodes.push node

  requestAnimationFrame move

<span class="function"><span class="title">keyHandler</span></span> = (e) -&gt;
  <span class="keyword">if</span> <span class="number">37</span> &lt;= e.keyCode &lt;= <span class="number">40</span>
    snake.direction = Math.PI/<span class="number">2</span> * ((e.keyCode - <span class="number">35</span>) % <span class="number">4</span>)

    <span class="keyword">return</span> <span class="literal">false</span>

<span class="function"><span class="title">show</span></span> = -&gt;
  document.addEventListener <span class="string">'keydown'</span>, keyHandler

  render()

<span class="function"><span class="title">hide</span></span> = -&gt;
  document.removeEventListener <span class="string">'keydown'</span>, keyHandler
  stop = <span class="literal">true</span>

  document.removeChild canvas

setTimeout -&gt;
  <span class="keyword">if</span> Offline.getOption(<span class="string">'game'</span>) <span class="keyword">and</span> document.addEventListener?
    Offline.<span class="literal">on</span> <span class="string">'down'</span>, show
    Offline.<span class="literal">on</span> <span class="string">'up'</span>, hide
    Offline.<span class="literal">on</span> <span class="string">'reconnect:failure'</span>, -&gt;
      fill = <span class="string">'#ec8787'</span>
      setTimeout -&gt;
        fill = <span class="string">'black'</span>
      , <span class="number">2000</span>
, <span class="number">0</span></pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
